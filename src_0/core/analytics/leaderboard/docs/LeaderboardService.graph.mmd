%% LeaderboardService Dependency Flow Graph
%% **Generated by Mermaid**
graph TD
  %% Main service class
  LeaderboardService["ğŸ† <b>LeaderboardService</b><br/>Manages leaderboard logic
  <br/>ğŸ›ï¸ Class | ğŸ”’ private, ğŸŸ¢ public
  <br/><i>Coordinates storage, scoring, ranking, and retrieval of leaderboard data</i>
  "]:::service

  %% Dependencies (external modules/interfaces)
  LeaderboardStorage["ğŸ’¾ LeaderboardStorage
  <br/>ğŸ·ï¸ Interface
  <br/><i>Persists & retrieves leaderboard and snapshots</i>
  "]:::storage

  scoringFn["ğŸ§® leaderboardScoringFnType
  <br/>ğŸ·ï¸ Type
  <br/><i>Defines signature for scoring strategies</i>
  "]:::type

  scoringStrategies["ğŸ§° scoringStrategies
  <br/>ğŸ“¦ Object
  <br/><i>Holds available scoring functions</i>
  "]:::util

  sorter["ğŸ”¢ GenericTickerSorter
  <br/>ğŸ·ï¸ Interface
  <br/><i>Sorts leaderboard entries</i>
  "]:::sorter

  kinetics["âš¡ percChangeKineticsCalculators
  <br/>ğŸ“¦ Object
  <br/><i>Calculates velocity and acceleration</i>
  "]:::util

  config["âš™ï¸ APP_CONFIG
  <br/>ğŸ“¦ Object
  <br/><i>Global configuration</i>
  "]:::config

  LeaderboardSnapshotsMap["ğŸ“„ LeaderboardSnapshotsMap
  <br/>ğŸ·ï¸ Type
  <br/><i>Batch of processed ticker data</i>
  "]:::type

  LeaderboardRestTickerSnapshot["ğŸ“Š LeaderboardRestTickerSnapshot
  <br/>ğŸ·ï¸ Type
  <br/><i>Leaderboard entry structure</i>
  "]:::type

  %% Entrypoint
  processNewSnapshots["â–¶ï¸ processNewSnapshots()
  <br/>ğŸŸ¢ public âš¡ async
  <br/>Input: ğŸ“„ LeaderboardSnapshotsMap, ğŸ”¢ GenericTickerSorter
  <br/>Output: ğŸ“Š Promise&lt;LeaderboardRestTickerSnapshot[]&gt;
  <br/>ğŸ’¾ persists, âš ï¸ error logging
  <br/><i>Batch orchestrator: processes, ranks, persists, returns leaderboard</i>
  "]:::method

  %% Key internal/private methods (bright yellow)
  initializeLeaderboardIfMissing["ğŸ› ï¸ initializeLeaderboardIfMissing()
  <br/>ğŸ”’ private âš¡ async
  <br/>Input: string
  <br/>Output: void (Promise)
  <br/>ğŸ’¾ creates leaderboard store if missing
  <br/><i>Ensures store exists for tag</i>
  "]:::privatemethod

  storeNewSnapshots["ğŸ’¾ storeNewSnapshots()
  <br/>ğŸ”’ private âš¡ async
  <br/>Input: ğŸ“„ LeaderboardSnapshotsMap, string
  <br/>Output: void (Promise)
  <br/>ğŸ’¾ persists, âš ï¸ error logging
  <br/><i>Stores each ticker snapshot in storage</i>
  "]:::privatemethod

  computeBatchKinetics["âš¡ computeBatchKinetics()
  <br/>ğŸ”’ private âš¡ async
  <br/>Input: ğŸ“„ LeaderboardSnapshotsMap, string
  <br/>Output: Map&lt;string, ğŸ“Š LeaderboardRestTickerSnapshot&gt; (Promise)
  <br/>ğŸ’¾ reads, âš ï¸ error logging
  <br/><i>Calculates velocity and acceleration for each ticker</i>
  "]:::privatemethod

  mergeWithPreviousLeaderboard["ğŸ”— mergeWithPreviousLeaderboard()
  <br/>ğŸ”’ private âš¡ async
  <br/>Input: string, Map&lt;string, ğŸ“Š LeaderboardRestTickerSnapshot&gt;
  <br/>Output: Map&lt;string, ğŸ“Š LeaderboardRestTickerSnapshot&gt; (Promise)
  <br/>ğŸ’¾ reads, âš ï¸ error logging
  <br/><i>Merges current and previous leaderboard states</i>
  "]:::privatemethod

  sortAndRankLeaderboard["ğŸ”¢ sortAndRankLeaderboard()
  <br/>ğŸ”’ private
  <br/>Input: ğŸ“Š LeaderboardRestTickerSnapshot[], ğŸ”¢ GenericTickerSorter
  <br/>Output: ğŸ“Š LeaderboardRestTickerSnapshot[]
  <br/><i>Sorts and assigns rank numbers</i>
  "]:::privatemethod

  persistLeaderboard["ğŸ’½ persistLeaderboard()
  <br/>ğŸ”’ private âš¡ async
  <br/>Input: string, ğŸ“Š LeaderboardRestTickerSnapshot[]
  <br/>Output: void (Promise)
  <br/>ğŸ’¾ persists, âš ï¸ throws
  <br/><i>Saves leaderboard to storage</i>
  "]:::privatemethod

  retreiveLeaderboard["ğŸ“¬ retreiveLeaderboard()
  <br/>ğŸŸ¢ public âš¡ async
  <br/>Input: string
  <br/>Output: ğŸ“Š Promise&lt;LeaderboardRestTickerSnapshot[] | null&gt;
  <br/>ğŸ’¾ reads
  <br/><i>Retrieves leaderboard for a given tag</i>
  "]:::method

  %% Flow
  LeaderboardService --> processNewSnapshots
  processNewSnapshots --> initializeLeaderboardIfMissing
  processNewSnapshots --> storeNewSnapshots
  processNewSnapshots --> computeBatchKinetics
  processNewSnapshots --> mergeWithPreviousLeaderboard
  processNewSnapshots --> sortAndRankLeaderboard
  processNewSnapshots --> persistLeaderboard
  processNewSnapshots -->|returns| sortAndRankLeaderboard

  %% Scoring and sorting
  processNewSnapshots -.-> scoringFn
  processNewSnapshots -.-> sorter

  %% Storage interactions
  initializeLeaderboardIfMissing --> LeaderboardStorage
  storeNewSnapshots --> LeaderboardStorage
  computeBatchKinetics --> LeaderboardStorage
  mergeWithPreviousLeaderboard --> LeaderboardStorage
  persistLeaderboard --> LeaderboardStorage
  retreiveLeaderboard --> LeaderboardStorage

  %% Kinetics calculations
  computeBatchKinetics --> kinetics
  computeBatchKinetics --> config

  %% Sorting
  sortAndRankLeaderboard --> sorter

  %% Input/Output types
  processNewSnapshots -.-> LeaderboardSnapshotsMap
  sortAndRankLeaderboard -.-> LeaderboardRestTickerSnapshot

  %% API
  LeaderboardService --> retreiveLeaderboard

  %% Scoring strategies
  LeaderboardService -.-> scoringStrategies

  %% Styles
  classDef service fill:#f9f,stroke:#222,stroke-width:2px;
  classDef storage fill:#e3f9e5,stroke:#222,stroke-width:1.5px;
  classDef type fill:#f9f9e3,stroke:#222,stroke-width:1.5px;
  classDef util fill:#e3e7f9,stroke:#222,stroke-width:1.5px;
  classDef sorter fill:#e3e7f9,stroke:#222,stroke-width:1.5px;
  classDef config fill:#f9e3e3,stroke:#222,stroke-width:1.5px;
  classDef method fill:#fff,stroke:#666,stroke-width:1px;
  classDef privatemethod fill:#ffff33,stroke:#666,stroke-width:2px;