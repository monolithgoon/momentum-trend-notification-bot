%% Combined: getMarketQuoteFetcherForStrategies + vendorStrategyRegistryMap with colored styling

graph TD

  %% Main factory function
  getMarketQuoteFetcherForStrategies["ğŸ­ <b>getMarketQuoteFetcherForStrategies()</b>
  <br/>ğŸŸ¢ public
  <br/>Input: ğŸ§­ vendor, ğŸ§© strategy keys[]
  <br/>Output: ğŸ› ï¸ SessionMarketQuoteFetcher
  <br/><i>Builds the correct quote fetcher based on vendor and strategies</i>
  "]:::method

  %% Registry helper functions
  isValidStrategyKey["ğŸ” isValidStrategyKey()
  <br/>ğŸŸ¢ public
  <br/><i>Type guard to validate strategy keys</i>
  "]:::method

  getStrategy["ğŸ” getStrategy()
  <br/>ğŸŸ¢ public
  <br/><i>Returns typed strategy instance from registry</i>
  "]:::method

  %% Polygon-specific fetcher
  PolygonMarketQuoteFetcher["ğŸ—ï¸ PolygonMarketQuoteFetcher
  <br/>ğŸ›ï¸ Class
  <br/><i>Concrete implementation for Polygon quotes</i>
  "]:::service

  PolygonSnapshotTransformer["ğŸ”„ PolygonSnapshotTransformer
  <br/>ğŸ›ï¸ Class
  <br/><i>Normalizes Polygon response format</i>
  "]:::service

  %% Strategy Registry Map
  vendorStrategyRegistryMap["ğŸ“¦ <b>vendorStrategyRegistryMap</b>
  <br/>ğŸ“¦ Object
  <br/><i>Map of vendor to strategy registry</i>
  "]:::util

  MarketDataVendor["ğŸ§­ MarketDataVendor
  <br/>ğŸ·ï¸ Enum
  <br/><i>Defines supported vendors</i>
  "]:::type

  polygonRegistry["ğŸ“¦ polygonRegistry
  <br/>ğŸ“¦ Object
  <br/><i>Record of Polygon strategy instances</i>
  "]:::util

  PolygonRestApiQuoteFetchStrategy["ğŸ“Š PolygonRestApiQuoteFetchStrategy
  <br/>ğŸ·ï¸ Interface
  <br/><i>Defines Polygon strategy behavior</i>
  "]:::type

  %% Strategy keys and classes
  PreMarket["ğŸ§² 'Pre-market top movers'
  <br/>ğŸ”§ PolygonPreMarketQuoteFetchStrategy
  "]:::highlight

  RecentIpo["ğŸš€ 'Recent IPO Top Moving'
  <br/>ğŸ”§ PolygonRecentIpoTopStrategy
  "]:::highlight

  CryptoPlacement["ğŸª™ 'Crypto Stocks with private placement'
  <br/>ğŸ”§ PolygonCryptoPrivatePlacementStrategy
  "]:::highlight

  ReverseSplitNews["ğŸ“ˆ 'Recent reverse splits with +ve news'
  <br/>ğŸ”§ PolygonReverseSplitPositiveNewsStrategy
  "]:::highlight

  %% Flow connections
  getMarketQuoteFetcherForStrategies --> isValidStrategyKey
  getMarketQuoteFetcherForStrategies --> getStrategy
  getMarketQuoteFetcherForStrategies --> vendorStrategyRegistryMap
  getMarketQuoteFetcherForStrategies -->|if vendor = POLYGON| PolygonMarketQuoteFetcher
  PolygonMarketQuoteFetcher --> PolygonSnapshotTransformer

  vendorStrategyRegistryMap -->|POLYGON| polygonRegistry
  polygonRegistry --> MarketDataVendor
  polygonRegistry --> PolygonRestApiQuoteFetchStrategy

  polygonRegistry --> PreMarket
  polygonRegistry --> RecentIpo
  polygonRegistry --> CryptoPlacement
  polygonRegistry --> ReverseSplitNews

  %% Styles
  classDef method fill:#fff,stroke:#666,stroke-width:1px;
  classDef util fill:#e3e7f9,stroke:#222,stroke-width:1.5px;
  classDef type fill:#dcdcdc,stroke:#222,stroke-width:1.5px;  %% grey for enums/interfaces
  classDef service fill:#f9f,stroke:#222,stroke-width:2px;
  classDef highlight fill:#ffff93,stroke:#222,stroke-width:2px;  %% bright yellow
